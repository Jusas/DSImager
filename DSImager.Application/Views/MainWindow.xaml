<views:BaseView
    x:TypeArguments="viewModels:MainViewModel" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
    xmlns:system="clr-namespace:System;assembly=mscorlib"
    xmlns:viewModels="clr-namespace:DSImager.ViewModels;assembly=DSImager.ViewModels"
    xmlns:app="clr-namespace:DSImager.Application"
    xmlns:views="clr-namespace:DSImager.Application.Views"
    xmlns:media="clr-namespace:System.Windows.Media;assembly=PresentationCore"
    xmlns:converters="clr-namespace:DSImager.Application.Converters"
    xmlns:interaction="http://schemas.microsoft.com/expression/2010/interactivity"
    xmlns:appcontrols="clr-namespace:DSImager.Application.Controls"
    x:Class="DSImager.Application.Views.MainWindow"
    Title="{Binding ViewTitle}" Height="768" Width="1366" Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}">
    <controls:MetroWindow.Resources>
        <converters:ListToIndexListConverter x:Key="ListToIndexListConverter"></converters:ListToIndexListConverter>
        <converters:ListLengthMinusOneConverter x:Key="ListLengthMinusOneConverter"></converters:ListLengthMinusOneConverter>
        <converters:ComposingConverter x:Key="TickIndicesToDoublesConverter">
            <converters:ComposingConverter.Converters>
                <converters:ListToIndexListConverter></converters:ListToIndexListConverter>
                <converters:NumberListDoubleCollectionConverter></converters:NumberListDoubleCollectionConverter>
            </converters:ComposingConverter.Converters>
        </converters:ComposingConverter>
    </controls:MetroWindow.Resources>
    <Grid x:Name="TopLevelGrid">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" x:Name="MainMenuItemRow"/>
            <RowDefinition Height="Auto" x:Name="MainToolBarRow"/>
            <RowDefinition Height="647*" x:Name="ImageAreaRow"/>
            <RowDefinition Height="30" x:Name="StatusBarRow"/>
        </Grid.RowDefinitions>
        <Menu HorizontalAlignment="Left" Grid.Row="0" VerticalAlignment="Top" Height="26" Width="{Binding ActualWidth, ElementName=TopLevelGrid}">
            <MenuItem Header="_File"/>
        </Menu>
        <ToolBarPanel x:Name="MainToolBarPanel" 
			Grid.Row="1" VerticalAlignment="Top" HorizontalAlignment="Left" 
			Width="Auto"
			Height="Auto" Orientation="Horizontal">
            <ToolBar HorizontalAlignment="Left" FontSize="24">
                <Button FontFamily="{DynamicResource FontAwesome}" 
					Content="&#xF0C7;" 
					Margin="4,0"
					ToolTip="Save visible frame"/>
                <Button FontFamily="{DynamicResource FontAwesome}" 
					Content="&#xF013;" 
					Margin="4,0"
					ToolTip="Settings"/>
                <Button FontFamily="{DynamicResource FontAwesome}" 
					Content="&#xF06D;" 
					Margin="4,0"
					ToolTip="Temperature controls"/>
                <Button FontFamily="{DynamicResource FontAwesome}" 
					Content="&#xF05A;" 
					Margin="4,0"
					ToolTip="Camera information"
                        Command="{Binding OpenDeviceInfoDialogCommand}"/>
                <!-- information about the connected camera -->
            </ToolBar>
            <ToolBar HorizontalAlignment="Left" FontSize="24">
                <Label Content="Preview" FontSize="14"/>
                <Button FontFamily="{DynamicResource FontAwesome}" 
					Content="&#xF030;" 
					Margin="4,0"
					ToolTip="Take snapshot"/>
                <!-- video camera f03d -->
                <!-- stop f04d -->
                <!-- turns to stop when taking exposure -->
                <Button FontFamily="{DynamicResource FontAwesome}" 
					Content="&#xF017;"
					Margin="4,0"
					Click="OnPreviewExposureClicked"
					ToolTip="Exposure setting">
                    <Button.ContextMenu>
                        <ContextMenu BorderBrush="Transparent" VerticalOffset="0" HasDropShadow="False">
                            <MenuItem>
                                <MenuItem.Template>
                                    <ControlTemplate TargetType="{x:Type MenuItem}">
                                        <StackPanel Height="32" Width="400" Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}" Orientation="Horizontal">
                                        <Grid Width="400" VerticalAlignment="Center">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            <appcontrols:PreviewExposureSlider 
                                                Style="{DynamicResource {x:Type Slider}}"
                                                IsSnapToTickEnabled="True" Width="400"
                                                IndexBoundValues="{Binding PreviewExposureOptions}"
												Height="20" 
												Value="{Binding SelectedPreviewExposureIndex}"
    											Minimum="0" 
                                                Maximum="{Binding PreviewExposureOptions, Converter={StaticResource ListLengthMinusOneConverter}}"
                                                TickPlacement="TopLeft" AutoToolTipPlacement="TopLeft" 
												LargeChange="5"
                                                Ticks="{Binding PreviewExposureOptions, Converter={StaticResource TickIndicesToDoublesConverter}}"
												BorderThickness="0,0,0,0"
                                                >
                                            </appcontrols:PreviewExposureSlider>
                                        </Grid>
                                        </StackPanel>
                                    </ControlTemplate>
                                </MenuItem.Template>
                            </MenuItem>
                        </ContextMenu>
                    </Button.ContextMenu>
                </Button>
                <CheckBox FontFamily="{DynamicResource FontAwesome}" 
					Content="&#xF01E;"
					Margin="4,0" 
					ToolTip="Toggle continuous exposure" />
                <Button FontFamily="{DynamicResource FontAwesome}"
					Content="&#xF009;"
					ToolTip="Binning" 
					Click="OnPreviewBinningClicked">
                    <Button.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="None" IsCheckable="True"/>
                            <MenuItem Header="2x2" IsCheckable="True"/>
                            <MenuItem Header="3x3" IsCheckable="True"/>
                        </ContextMenu>
                    </Button.ContextMenu>
                </Button>

            </ToolBar>
            <ToolBar HorizontalAlignment="Left" FontSize="24">
                <Label Content="Capture" FontSize="14"/>
                <Button FontFamily="{DynamicResource FontAwesome}" 
					Content="&#xF0AE;" 
					Margin="4,0"
					ToolTip="Manage profiles"/>
                <Button FontFamily="{DynamicResource FontAwesome}" 
					Content="&#xF030;" 
					Margin="4,0"
					ToolTip="Select a profile and begin capturing"/>
            </ToolBar>
        </ToolBarPanel>
        <Canvas Grid.Row="2" Name="ContentAreaCanvas">
            <Canvas Name="ProgressBarCanvas" Height="30" Width="{Binding Parent.ActualWidth, RelativeSource={RelativeSource Self}}" Panel.ZIndex="1">
                <ProgressBar Width="{Binding Parent.ActualWidth, RelativeSource={RelativeSource Self}}" Value="79.8" Panel.ZIndex="1" Background="Black" BorderBrush="Black" Height="{Binding Parent.ActualHeight, RelativeSource={RelativeSource Self}}" Opacity="0.4"></ProgressBar>
                <Label Content="Exposure 1/5 | Progress: 27% | Total Time Remaining: 3:39" Height="30" VerticalContentAlignment="Center" TextOptions.TextFormattingMode="Display" Canvas.Top="0" FontSize="14" Width="{Binding Parent.ActualWidth, RelativeSource={RelativeSource Self}}" HorizontalContentAlignment="Center" />
            </Canvas>
            <ScrollViewer HorizontalAlignment="Left" Width="{Binding Parent.ActualWidth, Mode=OneWay, RelativeSource={RelativeSource Self}}" 
                          Height="{Binding Parent.ActualHeight, Mode=OneWay, RelativeSource={RelativeSource Self}}">
                <Canvas Width="{Binding Width, ElementName=CameraImage, Mode=OneWay}" Height="{Binding Height, ElementName=CameraImage}">
                    <Image Name="CameraImage" Height="100" Width="100"/>
                </Canvas>

            </ScrollViewer>
        </Canvas>
        <StatusBar HorizontalAlignment="Left" Height="30" Grid.Row="3" VerticalAlignment="Top" Width="{Binding Parent.ActualWidth, RelativeSource={RelativeSource Self}}" Background="#FF343434" />


    </Grid>
</views:BaseView>
